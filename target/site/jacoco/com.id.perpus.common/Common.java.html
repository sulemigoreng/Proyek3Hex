<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Common.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PerpustakaanWebApp</a> &gt; <a href="index.source.html" class="el_package">com.id.perpus.common</a> &gt; <span class="el_source">Common.java</span></div><h1>Common.java</h1><pre class="source lang-java linenums">package com.id.perpus.common;

import java.io.BufferedOutputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.security.SecureRandom;
import java.text.SimpleDateFormat;
import java.util.Base64;
import java.util.Date;
import java.util.List;

import javax.servlet.http.HttpServletRequest;

import org.apache.commons.io.FileUtils;
import org.apache.commons.io.FilenameUtils;
import org.springframework.stereotype.Component;
import org.springframework.web.multipart.MultipartFile;


@Component
<span class="fc" id="L25">public class Common {</span>
	public static String encodeB64(String password) throws Exception {
<span class="nc" id="L27">		return Base64.getEncoder().encodeToString(password.getBytes(&quot;utf-8&quot;));</span>
	}

	public static String decodeB64(String password) throws Exception {
<span class="nc" id="L31">		byte[] base64decodedBytes = Base64.getDecoder().decode(password);</span>
<span class="nc" id="L32">		return new String(base64decodedBytes, &quot;utf-8&quot;);</span>
	}

	public static boolean emailValidation(String email) {
<span class="nc" id="L36">		String EMAIL_REGEX = &quot;^[\\w-_\\.+]*[\\w-_\\.]\\@([\\w]+\\.)+[\\w]+[\\w]$&quot;;</span>
<span class="nc" id="L37">		return email.matches(EMAIL_REGEX);</span>
	}

	public static boolean passwordValidation(String password) {
<span class="nc" id="L41">		String pattern = &quot;(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[-+_!*.,?@#$%^&amp;+=])(?=\\S+$).{8,}&quot;;</span>
<span class="nc" id="L42">		return password.matches(pattern);</span>
	}

	public static String MD5(String md5){
		try {
<span class="nc" id="L47">			java.security.MessageDigest md = java.security.MessageDigest.getInstance(&quot;MD5&quot;);</span>
<span class="nc" id="L48">			byte[] array = md.digest(md5.getBytes());</span>
<span class="nc" id="L49">			StringBuffer sb = new StringBuffer();</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">			for (int i = 0; i &lt; array.length; ++i) {</span>
<span class="nc" id="L51">				sb.append(Integer.toHexString((array[i] &amp; 0xFF) | 0x100).substring(1, 3));</span>
			}
			
<span class="nc" id="L54">			return sb.toString();</span>
<span class="nc" id="L55">		} catch (Exception e) {</span>
<span class="nc" id="L56">			e.printStackTrace();</span>
<span class="nc" id="L57">			return null;</span>
		}
	}
	
	public static String generatePassword(){
<span class="nc" id="L62">		String VALID_SPECIAL_CHARACTERS = &quot;!#$&quot;; </span>
<span class="nc" id="L63">		SecureRandom random = new SecureRandom();</span>
<span class="nc" id="L64">	    StringBuilder password = new StringBuilder();</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">	    while (password.length() &lt; 8) {</span>
<span class="nc" id="L66">	        char character = (char) random.nextInt(Character.MAX_VALUE);</span>
<span class="nc bnc" id="L67" title="All 14 branches missed.">	        if ((character &gt;= 'a' &amp;&amp; character &lt;= 'z') || (character &gt;= 'A' &amp;&amp; character &lt;= 'Z') || (character &gt;= '0' &amp;&amp; character &lt;= '9') || VALID_SPECIAL_CHARACTERS.contains(String.valueOf(character))) {</span>
<span class="nc" id="L68">	            password.append(character);</span>
	        }
	    }
<span class="nc" id="L71">	    return password.toString();</span>
	}
	
	public static String toString(String s){
		try {
<span class="nc bnc" id="L76" title="All 2 branches missed.">			if(s != null){</span>
<span class="nc" id="L77">				return s.trim();</span>
			}else{
<span class="nc" id="L79">				return &quot;&quot;;</span>
			}
<span class="nc" id="L81">		} catch (Exception e) {</span>
<span class="nc" id="L82">			return &quot;&quot;;</span>
		}
	}
	
	public static String toString(Object s){
		try {
<span class="nc bnc" id="L88" title="All 2 branches missed.">			if(s != null){</span>
<span class="nc" id="L89">				return s.toString().trim();</span>
			}else{
<span class="nc" id="L91">				return &quot;&quot;;</span>
			}
<span class="nc" id="L93">		} catch (Exception e) {</span>
<span class="nc" id="L94">			return &quot;&quot;;</span>
		}
	}
	
	public static String toStrip(String s){
		try {
<span class="nc bnc" id="L100" title="All 2 branches missed.">			if(s != null){</span>
<span class="nc" id="L101">				return s.trim();</span>
			}else{
<span class="nc" id="L103">				return &quot;-&quot;;</span>
			}
<span class="nc" id="L105">		} catch (Exception e) {</span>
<span class="nc" id="L106">			return &quot;-&quot;;</span>
		}
	}
	
	public static String toListJobsTemplate(List&lt;String&gt; jobs){
<span class="nc" id="L111">		StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L112">		sb.append(&quot;&lt;ol&gt;&quot;);</span>
<span class="nc bnc" id="L113" title="All 4 branches missed.">		if(jobs != null &amp;&amp; jobs.size() &gt; 0){</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">			for (String job : jobs) {</span>
<span class="nc" id="L115">				sb.append(&quot;&lt;li&gt;&quot;+job+&quot;&lt;/li&gt;&quot;);</span>
			}
		}
<span class="nc" id="L118">		sb.append(&quot;&lt;/ol&gt;&quot;);</span>
<span class="nc" id="L119">		return sb.toString();</span>
	}
	
	public static byte[] doConvertFileToByte(File f) throws Exception{
<span class="nc" id="L123">		FileInputStream fis = null;</span>
<span class="nc" id="L124">		ByteArrayOutputStream bos = null;</span>
		try {
<span class="nc" id="L126">			fis = new FileInputStream(f);</span>
<span class="nc" id="L127">			byte[] buffer = new byte[1024];</span>
<span class="nc" id="L128">			bos = new ByteArrayOutputStream();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">			for (int len; (len = fis.read(buffer)) != -1;) {</span>
<span class="nc" id="L130">                bos.write(buffer, 0, len);</span>
            }
<span class="nc" id="L132">			return bos.toByteArray();</span>
<span class="nc" id="L133">		} catch (Exception e) {</span>
<span class="nc" id="L134">			throw e;</span>
		}finally {
<span class="nc bnc" id="L136" title="All 2 branches missed.">			if(fis != null){</span>
<span class="nc" id="L137">				fis.close();</span>
			}
		}
		
	}
	
	public static void convertFromByteToFile(byte[] bit, String dest)throws Exception{
<span class="nc" id="L144">		FileOutputStream fos = null;</span>
		try {
<span class="nc" id="L146">			byte[] buffer = bit;</span>
<span class="nc" id="L147">			fos = new FileOutputStream(dest);</span>
<span class="nc" id="L148">			fos.write(buffer);</span>
<span class="nc" id="L149">		} catch (Exception e) {</span>
<span class="nc" id="L150">			throw e;</span>
		}finally {
<span class="nc bnc" id="L152" title="All 2 branches missed.">			if(fos != null){</span>
<span class="nc" id="L153">				fos.close();</span>
			}
		}
		
<span class="nc" id="L157">	}</span>
	
	public static String emptyToNull (String input){
<span class="nc bnc" id="L160" title="All 2 branches missed.">		if(&quot;&quot;.equals(input)){</span>
<span class="nc" id="L161">			return null;</span>
		}else{
<span class="nc" id="L163">			return input;</span>
		}
	}
	
	public static String nullToEmpty (String input){
<span class="nc bnc" id="L168" title="All 2 branches missed.">		if(input == null){</span>
<span class="nc" id="L169">			return &quot;&quot;;</span>
		}else{
<span class="nc" id="L171">			return input;</span>
		}
	}
	public static String nullToEmpty (Object input){
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if(input == null){</span>
<span class="nc" id="L176">			return &quot;&quot;;</span>
		}else{
<span class="nc" id="L178">			return input.toString();</span>
		}
	}
	
	public static int stringToInteger (String input){
		try{
<span class="nc" id="L184">			return Integer.parseInt(input);</span>
<span class="nc" id="L185">		}catch (Exception e){</span>
<span class="nc" id="L186">			return 0;</span>
		}
	}
	
	public static String doUpload(HttpServletRequest request, MultipartFile file,  String dest, String userId, String source) {
<span class="nc" id="L191">        String root = request.getServletContext().getRealPath(&quot;/&quot;);</span>
        try {
<span class="nc bnc" id="L193" title="All 4 branches missed.">        	if (file != null &amp;&amp; !file.isEmpty()) {</span>
    			try {
<span class="nc" id="L195">    				String filename = file.getOriginalFilename();</span>
<span class="nc" id="L196">    				String ext = FilenameUtils.getExtension(filename); // returns &quot;txt&quot;</span>
<span class="nc" id="L197">    				filename = userId + &quot;.&quot; +ext;</span>
    				
<span class="nc" id="L199">    				byte[] bytes = file.getBytes();</span>
    				
<span class="nc" id="L201">    				String file_location = root + Constanta.DIST + dest;</span>
<span class="nc" id="L202">    				File dir = new File(file_location);</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">    				if (!dir.exists()){</span>
<span class="nc" id="L204">    					dir.mkdirs();</span>
    				}

    				// Create the file on server
<span class="nc" id="L208">    				File serverFile = new File(dir.getAbsolutePath() +&quot;\\&quot;+ filename);</span>
<span class="nc" id="L209">    				BufferedOutputStream stream = new BufferedOutputStream(new FileOutputStream(serverFile));</span>
<span class="nc" id="L210">    				stream.write(bytes);</span>
<span class="nc" id="L211">    				stream.close();</span>
    				
<span class="nc" id="L213">    				File copyTo = new File(source + &quot;\\&quot; + filename);</span>
    				
<span class="nc" id="L215">    				copyFile(serverFile, copyTo);</span>
<span class="nc" id="L216">    				System.out.println(&quot;Server File Location=&quot; + serverFile.getAbsolutePath());</span>

<span class="nc" id="L218">    				 return filename;</span>
<span class="nc" id="L219">    			} catch (Exception e) {</span>
<span class="nc" id="L220">    				return &quot;no-pp.jpg&quot;;</span>
    			}
    			
    			
    		} else {
<span class="nc" id="L225">    			return &quot;no-pp.jpg&quot;;</span>
    		}
           
<span class="nc" id="L228">        } catch (Exception e) {</span>
<span class="nc" id="L229">        	return null;</span>
        }
	}
	
	public static String doUploadPicture(HttpServletRequest request, MultipartFile file,  String dest, String id, String source) {
<span class="nc" id="L234">        String root = request.getServletContext().getRealPath(&quot;/&quot;);</span>
        try {
<span class="nc bnc" id="L236" title="All 4 branches missed.">        	if (file != null &amp;&amp; !file.isEmpty()) {</span>
    			try {
<span class="nc" id="L238">    				String filename = file.getOriginalFilename();</span>
<span class="nc" id="L239">    				String ext = FilenameUtils.getExtension(filename); // returns &quot;txt&quot;</span>
<span class="nc" id="L240">    				filename = id + &quot;.&quot; +ext;</span>
    				
<span class="nc" id="L242">    				byte[] bytes = file.getBytes();</span>
    				
<span class="nc" id="L244">    				String file_location = root + Constanta.DIST + dest;</span>
<span class="nc" id="L245">    				File dir = new File(file_location);</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">    				if (!dir.exists()){</span>
<span class="nc" id="L247">    					dir.mkdirs();</span>
    				}

    				// Create the file on server
<span class="nc" id="L251">    				File serverFile = new File(dir.getAbsolutePath() +&quot;\\&quot;+ filename);</span>
<span class="nc" id="L252">    				BufferedOutputStream stream = new BufferedOutputStream(new FileOutputStream(serverFile));</span>
<span class="nc" id="L253">    				stream.write(bytes);</span>
<span class="nc" id="L254">    				stream.close();</span>
    				
<span class="nc" id="L256">    				File copyTo = new File(source + &quot;\\&quot; + filename);</span>
    				
<span class="nc" id="L258">    				copyFile(serverFile, copyTo);</span>
<span class="nc" id="L259">    				System.out.println(&quot;Server File Location=&quot; + serverFile.getAbsolutePath());</span>

<span class="nc" id="L261">    				 return filename;</span>
<span class="nc" id="L262">    			} catch (Exception e) {</span>
<span class="nc" id="L263">    				return null;</span>
    			}
    			
    			
    		} else {
<span class="nc" id="L268">    			return null;</span>
    		}
           
<span class="nc" id="L271">        } catch (Exception e) {</span>
<span class="nc" id="L272">        	return null;</span>
        }
	}

	
	public static String doUploadAttachment(HttpServletRequest request, MultipartFile file,  String dest,  String source) {
<span class="nc" id="L278">        String root = request.getServletContext().getRealPath(&quot;/&quot;);</span>
        try {
<span class="nc bnc" id="L280" title="All 4 branches missed.">        	if (file != null &amp;&amp; !file.isEmpty()) {</span>
    			try {
<span class="nc" id="L282">    				String filename = file.getOriginalFilename();</span>
    				//String ext = FilenameUtils.getExtension(filename); // returns &quot;txt&quot;
    				
    				//byte[] bytes = file.getBytes();
    				
<span class="nc" id="L287">    				String file_location = root + Constanta.DIST + dest;</span>
<span class="nc" id="L288">    				File dir = new File(file_location);</span>
<span class="nc bnc" id="L289" title="All 2 branches missed.">    				if (!dir.exists()){</span>
<span class="nc" id="L290">    					dir.mkdirs();</span>
    				}

    				// Create the file on server
<span class="nc" id="L294">    				File serverFile = new File(dir.getAbsolutePath() +&quot;\\&quot;+ filename);</span>
<span class="nc" id="L295">    				BufferedOutputStream stream = new BufferedOutputStream(new FileOutputStream(serverFile));</span>
    				// new process
<span class="nc" id="L297">    				InputStream dataUploadFile = file.getInputStream();</span>
    				int bytes;
<span class="nc bnc" id="L299" title="All 2 branches missed.">    				while ((bytes=dataUploadFile.read()) != -1){</span>
<span class="nc" id="L300">    					stream.write(bytes);</span>
    				}
    				// end new process
    				//stream.write(bytes);
<span class="nc" id="L304">    				stream.close();</span>
<span class="nc" id="L305">    				dataUploadFile.close(); // new</span>
    				
<span class="nc" id="L307">    				File copyTo = new File(source + &quot;\\&quot; + filename);</span>
    				
<span class="nc" id="L309">    				copyFile(serverFile, copyTo);</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">    				if(serverFile.delete()){</span>
<span class="nc" id="L311">    					System.out.println(&quot;temp File deleted&quot; + serverFile.getAbsolutePath());</span>
					}
<span class="nc" id="L313">    				System.out.println(&quot;Server File Location=&quot; + serverFile.getAbsolutePath());</span>

<span class="nc" id="L315">    				 return filename;</span>
<span class="nc" id="L316">    			} catch (Exception e) {</span>
<span class="nc" id="L317">    				return &quot;&quot;;</span>
    			}
    			
    			
    		} else {
<span class="nc" id="L322">    			return &quot;&quot;;</span>
    		}
           
<span class="nc" id="L325">        } catch (Exception e) {</span>
<span class="nc" id="L326">        	return null;</span>
        }
	}
	
	public static void copyFile(File source, File dest) throws IOException {
		try {			
<span class="nc" id="L332">			FileUtils.copyFile(source, dest);</span>
<span class="nc" id="L333">		} catch (Exception e) {</span>
			// TODO: handle exception
		}
<span class="nc" id="L336">	}</span>
	
	public static long toLong(String s){
		try {
<span class="nc" id="L340">			return Long.parseLong(s);</span>
<span class="nc" id="L341">		} catch (Exception e) {</span>
<span class="nc" id="L342">			return (long)0;</span>
		}
	}
	
	public static String formatDateYearOnly(Date s){
		try {
<span class="nc" id="L348">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy&quot;);</span>
<span class="nc" id="L349">			return sdf.format(s);</span>
<span class="nc" id="L350">		} catch (Exception e) {</span>
<span class="nc" id="L351">			return &quot;&quot;;</span>
		}
	}
	
	public static String formatDateYYYYMMDD(Date s){
		try {
<span class="nc" id="L357">			SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyyMMdd&quot;);</span>
<span class="nc" id="L358">			return sdf.format(s);</span>
<span class="nc" id="L359">		} catch (Exception e) {</span>
<span class="nc" id="L360">			return &quot;&quot;;</span>
		}
	}
	
	public static String integerToString03Format(int number){
<span class="nc" id="L365">		return String.format(&quot;%03d&quot;, number);</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>